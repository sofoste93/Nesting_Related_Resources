                        --------------------------------------------------------------
                         |                  Nested Related Resources                |
                        --------------------------------------------------------------


                        ==============================================================
                                         # Understand Nested Resources
                        ==============================================================
                        - Resource: a set of data or functionality of a single type
                        - Subjects, pages, admins
                        - Nested resource: a resource inside another resource
                        - Dependent
                        - One-To-Many Relationships

                        i.e: | Subjects
                                  -Pages

                        - No direct access to pages
                        - Access pages through subjects
                        - Group pages by subject
                        - All links and redirects must work with new structure

                        ==============================================================
                                         # List pages by subject
                        ==============================================================
                        <?php
                        require_login();

                        // $id = isset($_GET['id']) ? $_GET['id'] : '1';
                        $id = $_GET['id'] ?? '1'; // PHP > 7.0

                        $subject = find_subject_by_id($id);

                        //$page_set = find_all_pages(); // but there's a problem with this ..:-)
                        /* all pages will be listed, we just want pages to be listed if belong to the subject_id*/
                        // so we better use our function find_pages_by_subject_id()
                        $page_set = find_pages_by_subject_id($id); // second param not a must
                        ?>


                        ==============================================================
                                         # Use nested links
                        ==============================================================
                        So, the key thing that you need to remember about these nested
                        links is making sure that you can pass around the information
                        you need to maintain your nested state, so that you know what
                        the parent record is.
                            Sometimes you may be able to get that from the parent itself,
                        sometimes, you can get it from the foreign key of the child object,
                        sometimes you need to pass it in the URL so that you know it.
                        There's actually a fourth possibility as well, which is that if
                        we go to submit our form for our new page, we still have the subject ID,
                        and that's because it's in the form data. It's passed in in the form data,
                        so when we call URL four, we're not passing in the subject ID there,
                        it's actually down here in the form data, and that allows us to be able
                        to use it up here inside the form processing.

                        ==============================================================
                                         # Use nested redirects
                        ==============================================================
                        If it doesn't exist, then don't try and delete it, right? Do something
                        different instead, redirect. Redirect back to another page saying, hey sorry,
                        the page you just wanted to delete doesn't exist, right? So I can think of a
                        lot of ways that I could provide better error checking if I first go and look
                        for the page before I try and delete it. So that's why I picked this one.
                        So we'll save the result. So now we've counted for all of our links, all of
                        our forms, and all of our redirects. They all work now with our new nested structure.

                        ==============================================================
                                         # Add page count to each subject
                        ==============================================================
                        $page_set = find_pages_by_subject_id($id);
                        $page_count = mysqli_num_rows($page_set);
                        mysqli_free_result($page_set);
                          // count pages by subject_id
                          function count_pages_by_subject_id($subject_id, $options=[]) {
                            global $db;

                            $visible = $options['visible'] ?? false;

                            $sql = "SELECT COUNT(id) FROM pages "; // don't return the data to me, but count them instead
                            $sql .= "WHERE subject_id='" . db_escape($db, $subject_id) . "' ";
                            if($visible) {
                              $sql .= "AND visible = true ";
                            }
                            $sql .= "ORDER BY position ASC";
                            $result = mysqli_query($db, $sql);
                            confirm_result_set($result);
                            $row = mysqli_fetch_row($result);
                            mysqli_free_result($result);
                            $count = $row[0];
                            return $count; // we now get counted rows returned /not result anymore
                          }

                        ==============================================================
                                         # Scope page position by subject
                        ==============================================================



                        ==============================================================
                                         # Update positions
                        ==============================================================

